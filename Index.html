<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Remote Browser Proxy</title>
<style>
  body { 
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    padding: 20px;
  }
  
  .card { 
    background: #fff;
    color: #333;
    padding: 35px;
    max-width: 380px;
    width: 100%;
    border-radius: 16px;
    box-shadow: 0 20px 60px rgba(0,0,0,.3);
  }
  
  h2 { margin: 0 0 20px 0; font-size: 24px; text-align: center; }
  input { width: 100%; padding: 12px; margin-top: 10px; border-radius: 8px; border: 2px solid #e0e0e0; font-size: 14px; transition: border-color .3s; }
  input:focus { outline: none; border-color: #667eea; }

  button { width: 100%; margin-top: 12px; padding: 14px; border-radius: 8px; border: 0; cursor: pointer; background: #667eea; color: #fff; font-weight: 700; font-size: 14px; transition: all .3s; }
  button:hover { background: #5568d3; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102, 126, 234, .4); }
  button:disabled { background: #ccc; cursor: not-allowed; transform: none; }

  .wake-btn { background: #ffd34d; color: #000; }
  .wake-btn:hover { background: #ffc61a; }

  .status { margin-top: 15px; padding: 12px; border-radius: 8px; display: none; font-size: 14px; text-align: center; }
  .status.show { display: block; }
  .status.success { background: #e6ffe8; color: #056632; border: 1px solid #b3f0b8; }
  .status.error { background: #ffe8e8; color: #7b1f1f; border: 1px solid #ffb3b3; }
  .status.info { background: #e8f4ff; color: #0d4a7a; border: 1px solid #b3d9ff; }

  .spinner { display: inline-block; width: 14px; height: 14px; border: 2px solid rgba(0,0,0,.1); border-left-color: currentColor; border-radius: 50%; animation: spin .8s linear infinite; margin-right: 8px; }
  @keyframes spin { to { transform: rotate(360deg); } }
</style>
</head>
<body>

<div class="card">
  <h2>üåê Remote Browser</h2>

  <input id="name" placeholder="Your Name">
  <input id="key" type="password" placeholder="Your Key">

  <button class="wake-btn" id="wakeBtn">‚òï Wake Server</button>
  <button id="loginBtn">üöÄ Login & Launch</button>

  <div id="status" class="status"></div>
</div>

<script>
// REAL API URL
const API = "https://render-repo-1-yto6.onrender.com";

// Show messages
function setStatus(msg, type) {
  const el = document.getElementById("status");
  el.innerHTML = msg;
  el.className = "status show " + type;
}

// Wake server
async function handleWake() {
  setStatus('<span class="spinner"></span>Waking...', 'info');
  try {
    const res = await fetch(API + "/health");
    const j = await res.json();
    if (j.status === "ok") setStatus("‚úÖ Server ready!", "success");
    else setStatus("‚ö†Ô∏è Server responded but not OK", "error");
  } catch (e) {
    setStatus("‚ùå " + e.message, "error");
  }
}

// Login
async function handleLogin() {
  const name = nameInput.value.trim();
  const key = keyInput.value.trim();

  if (!name || !key) {
    setStatus("‚ùå Missing name or key", "error");
    return;
  }

  setStatus('<span class="spinner"></span>Checking...', "info");

  try {
    const res = await fetch(API + "/validate?name=" + encodeURIComponent(name) + "&key=" + encodeURIComponent(key));
    const j = await res.json();

    if (!j.valid) return setStatus("‚ùå Invalid credentials", "error");

    const wsURL = API.replace("https://", "wss://") + "/ws";

    const popup = window.open("", "_blank", "width=1400,height=900");

    popup.document.write(`
      <html><body style="margin:0;background:black;color:white;display:flex;align-items:center;justify-content:center;font-family:Arial">
      <div id="msg">Connecting to server...</div>
      <script>
      const ws = new WebSocket("${wsURL}");
      ws.binaryType = "arraybuffer";

      ws.onopen = () => { 
        document.getElementById("msg").innerText = "Connected! Launching..."; 
        ws.send(JSON.stringify({type:"control", action:"create", userName:"${name}"}));
      };

      ws.onmessage = (e) => {
        if (typeof e.data === "string") {
          const j = JSON.parse(e.data);
          if (j.type === "info" && j.action === "created") {
            ws.send(JSON.stringify({type:"control", action:"startStream"}));
            document.getElementById("msg").innerText = "Streaming...";
          }
        }
      };
      <\/script>
      </body></html>
    `);

    setStatus("‚úÖ Remote browser launched!", "success");

  } catch (e) {
    setStatus("‚ùå " + e.message, "error");
  }
}

// buttons
const nameInput = document.getElementById("name");
const keyInput = document.getElementById("key");

document.getElementById("wakeBtn").onclick = handleWake;
document.getElementById("loginBtn").onclick = handleLogin;

</script>

</body>
</html>
